from flask import Flask, request, jsonify

app = Flask(__name__)

data_store = {
    "inventory_items": [],
    "borrowed_items": [],
    "students": []
}

@app.route('/api/inventory', methods=['GET', 'POST'])
def inventory():
    if request.method == 'GET':
        return jsonify(data_store['inventory_items'])
    elif request.method == 'POST']:
        item_id = len(data_store['inventory_items']) + 1
        item = {
            'id': item_id,
            'name': request.form['name'],
            'category': request.form['category'],
            'description': request.form['description'],
            'image': request.files['image'].filename if 'image' in request.files else None,
            'status': 'available'
        }
        data_store['inventory_items'].append(item)
        return jsonify({'success': True, 'item': item})

@app.route('/api/borrow', methods=['POST'])
def borrow():
    data = request.json
    item_id = data['itemId']
    student_id = data['studentId']
    borrow_time = data['borrowTime']
    return_time = data['returnTime']

    item = next((item for item in data_store['inventory_items'] if item['id'] == item_id), None)
    if item and item['status'] == 'available':
        item['status'] = 'borrowed'
        borrowed_item = {
            'itemId': item_id,
            'studentId': student_id,
            'borrowDate': borrow_time,
            'dueDate': return_time
        }
        data_store['borrowed_items'].append(borrowed_item)
        return jsonify({'success': True, 'item': item})
    return jsonify({'success': False, 'message': 'Item not available for borrowing'})

@app.route('/api/students', methods=['GET', 'POST'])
def students():
    if request.method == 'GET':
        return jsonify(data_store['students'])
    elif request.method == 'POST']:
        student_id = len(data_store['students']) + 1
        student = {
            'id': student_id,
            'name': request.json['name'],
            'email': request.json['email']
        }
        data_store['students'].append(student)
        return jsonify({'success': True, 'student': student})

if __name__ == '__main__':
    app.run(debug=True)